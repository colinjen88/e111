# E111 å¾¡æ‰‹åœ‹é†« â€” å…¨é¢å„ªåŒ–è¨ˆç•«

> **å»ºç«‹æ—¥æœŸ**: 2026-02-13  
> **åˆ†æ”¯**: `dev` (å„ªåŒ–å®Œæˆå¾Œ merge å› `master`)  
> **åŸå‰‡**: ä¸ä¸­æ–·ç·šä¸Šæœå‹™ï¼Œæ‰€æœ‰è®Šæ›´å…ˆåœ¨ dev åˆ†æ”¯é©—è­‰  
> **æœ€å¾Œæ›´æ–°**: 2026-02-13 Phase 1-4 å¤§éƒ¨åˆ†å·²å®Œæˆ

---

## ğŸ“Š å„ªåŒ–ç¸½è¦½

| éšæ®µ | åç¨± | å„ªå…ˆç´š | å®Œæˆç‹€æ…‹ |
|------|------|--------|----------|
| Phase 1 | ğŸ”’ å®‰å…¨åŠ å›º | P0 - ç·Šæ€¥ | âœ… 6/6 å®Œæˆ |
| Phase 2 | ğŸ§¹ ç¨‹å¼ç¢¼æ¸…ç† | P1 - é‡è¦ | âœ… 7/7 å®Œæˆ |
| Phase 3 | ğŸ—ï¸ æ¶æ§‹é‡æ§‹ | P2 - æ”¹é€² | â¬œ 2/4 å®Œæˆ |
| Phase 4 | âš™ï¸ DevOps å®Œå–„ | P2 - æ”¹é€² | âœ… 3/4 å®Œæˆ |
| Phase 5 | ğŸ§ª æ¸¬è©¦è£œå¼· | P3 - å„ªåŒ– | â¬œ 0/3 |
| Phase 6 | ğŸ’ é«”é©—æ‰“ç£¨ | P3 - å„ªåŒ– | âœ… 1/3 å®Œæˆ |

---

## Phase 1: ğŸ”’ å®‰å…¨åŠ å›º (P0) â€” âœ… å…¨éƒ¨å®Œæˆ

### âœ… 1.1 æ¸…é™¤ Git æ­·å²ä¸­çš„æ•æ„Ÿè³‡æ–™
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **èªªæ˜**: ä½¿ç”¨ `git-filter-repo` æ¸…é™¤æ‰€æœ‰æ­·å² commit ä¸­çš„ VPS å¯†ç¢¼ã€IP ä½å€
- **å·²æ¨é€**: Force push è‡³ GitHub master

### âœ… 1.2 é‡å¯«éƒ¨ç½²è…³æœ¬
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **èªªæ˜**: æ”¹ç‚ºå¾ç’°å¢ƒè®Šæ•¸è®€å–èªè­‰è³‡è¨Š
- **ä½¿ç”¨æ–¹å¼**: `$env:VPS_HOST = "your-ip"; .\scripts\deploy_vps.ps1`

### âœ… 1.3 ç§»é™¤ nginx.conf ä¸­çš„ IP
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

### âœ… 1.4 deploy.tar.gz åŠ å…¥ .gitignore
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

### âœ… 1.5 ä¿®å¾© Admin èªè­‰å®‰å…¨
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **è®Šæ›´**:
  - [x] ç§»é™¤ `console.log` ä¸­çš„æ˜æ–‡å¯†ç¢¼è¼¸å‡º
  - [x] Cookie è¨­ç‚º `httpOnly: true`
  - [x] Production ç’°å¢ƒè¨­ `secure: true`
  - [x] ç§»é™¤ hardcoded fallback å¯†ç¢¼
  - [x] ä½¿ç”¨ `crypto.randomBytes()` ç”¢ç”Ÿéš¨æ©Ÿ session token
  - [x] æ–°å¢ server-side session store (`session-store.ts`)
  - [x] æ–°å¢ `/api/admin/me` (èº«ä»½é©—è­‰æª¢æŸ¥)
  - [x] æ–°å¢ `/api/admin/logout` (æ­£ç¢ºæ¸…é™¤ session)
  - [x] æ›´æ–° `auth.ts` ä½¿ç”¨ session store é©—è­‰

### âœ… 1.6 ç§»é™¤ç™»å…¥é å¯†ç¢¼æç¤º
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **è®Šæ›´**:
  - [x] ç§»é™¤å¯†ç¢¼æç¤ºå€å¡Š
  - [x] ç§»é™¤æ‰€æœ‰ debug `console.log`
  - [x] æ¸…ç† login.vue ç‚ºä¹¾æ·¨çš„ production ç‰ˆæœ¬

---

## Phase 2: ğŸ§¹ ç¨‹å¼ç¢¼æ¸…ç† (P1) â€” âœ… å…¨éƒ¨å®Œæˆ

### âœ… 2.1 åˆªé™¤æ¸¬è©¦/æ®˜ç•™æª”æ¡ˆ
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- å·²åˆªé™¤: `index_test.vue`, `seed.js`, `codereview.md`, `check_conn.ps1`, `check_db.ts`, `diagnose.sh`, `task.md`

### âœ… 2.2 çµ±ä¸€éƒ¨ç½²è…³æœ¬
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- åˆªé™¤äº†é‡è¤‡çš„ `e111-booking/deploy.sh`

### âœ… 2.3 ä¿®æ­£ @prisma/client åˆ†é¡
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- ç§»åˆ° `dependencies`

### âœ… 2.4 çµ±ä¸€ DevServer åŸ è™Ÿ
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- çµ±ä¸€ç‚º port 3003

### âœ… 2.5 æ¸…ç† Schema è¨»è§£
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- ç§»é™¤ SQLite éºç•™è¨»è§£ï¼ŒåŠ å…¥ Prisma doc comments (`///`)

### âœ… 2.6 ä¿®å¾© Calendar é é¢ Bug
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- æ–°å¢ `today()` å‡½å¼

### âœ… 2.7 docker-compose ç¾ä»£åŒ–
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- ç§»é™¤ `version` field
- ç”Ÿç”¢ç’°å¢ƒ DB å¯†ç¢¼æ”¹ç”¨ç’°å¢ƒè®Šæ•¸

---

## Phase 3: ğŸ—ï¸ æ¶æ§‹é‡æ§‹ (P2) â€” éƒ¨åˆ†å®Œæˆ

### â¬œ 3.1 æ‹†åˆ† booking.vue å¤§å…ƒä»¶
- **ç‹€æ…‹**: ğŸ”² å¾…è™•ç†
- **æª”æ¡ˆ**: `app/pages/booking.vue` (672è¡Œ, 34KB)
- **è®Šæ›´**:
  - [ ] æŠ½å‡º `components/booking/StepBranch.vue`
  - [ ] æŠ½å‡º `components/booking/StepService.vue`
  - [ ] æŠ½å‡º `components/booking/StepStaff.vue`
  - [ ] æŠ½å‡º `components/booking/StepDateTime.vue`
  - [ ] æŠ½å‡º `components/booking/StepConfirm.vue`
  - [ ] æŠ½å‡º `components/booking/StepSuccess.vue`
  - [ ] ä¸»é é¢åªåšæ­¥é©Ÿæµç¨‹æ§åˆ¶ + å…±ç”¨ç‹€æ…‹ (composable or provide/inject)

### âœ… 3.2 çµ±ä¸€ Error Handling
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **è®Šæ›´**:
  - [x] æ–°å¢ `app/error.vue` (Nuxt 3 å…¨åŸŸéŒ¯èª¤é é¢)
  - [x] API éŒ¯èª¤ä¸å†æš´éœ² `error.message` åŸå§‹éŒ¯èª¤
  - [x] å»ºç«‹ `server/utils/error-handler.ts` å…±ç”¨ error wrapper
  - [x] ä¿®å¾© `stats.get.ts` å’Œ `bookings/index.post.ts` çš„éŒ¯èª¤æš´éœ²

### â¬œ 3.3 é€£æ¥çœŸå¯¦é€šçŸ¥æœå‹™
- **ç‹€æ…‹**: ğŸ”² å¾…è™•ç†
- **è®Šæ›´**:
  - [ ] çµ±ä¸€ `notify.ts` å’Œ `line.ts`
  - [ ] æ¨™è¨˜ email åŠŸèƒ½ç‚ºã€ŒComing Soonã€

### â¬œ 3.4 å¯¦ä½œ Admin Settings é é¢
- **ç‹€æ…‹**: ğŸ”² å¾…è™•ç†
- **è®Šæ›´**:
  - [ ] æ›¿æ› mock `setTimeout` ç‚ºçœŸæ­£çš„ API call
  - [ ] æˆ–è€…æ¨™è¨˜ UI ç‚º "Coming Soon"

---

## Phase 4: âš™ï¸ DevOps å®Œå–„ (P2) â€” å¤§éƒ¨åˆ†å®Œæˆ

### â¬œ 4.1 å¼·åŒ– CI Pipeline
- **ç‹€æ…‹**: ğŸ”² å¾…è™•ç†
- **è®Šæ›´**:
  - [ ] åŠ å…¥ `npm run test` æ­¥é©Ÿ
  - [ ] åŠ å…¥ ESLint / Prettier æª¢æŸ¥

### âœ… 4.2 æ”¹å–„ Dockerfile CMD
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- æ”¹ç”¨ `docker-entrypoint.sh` å« DB wait loop

### âœ… 4.3 æ”¹å–„ Rate Limiter
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- é™ä½é–¾å€¼ + åŠ å…¥å®šæœŸæ¸…ç†

### âœ… 4.4 docker-compose å¯†ç¢¼å®‰å…¨åŒ–
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ (åˆä½µè‡³ 2.7)

---

## Phase 5: ğŸ§ª æ¸¬è©¦è£œå¼· (P3) â€” å¾…è™•ç†

### â¬œ 5.1 è£œå¯« API å–®å…ƒæ¸¬è©¦
- **ç‹€æ…‹**: ğŸ”² å¾…è™•ç†

### â¬œ 5.2 è£œå¯«å‰ç«¯å…ƒä»¶æ¸¬è©¦
- **ç‹€æ…‹**: ğŸ”² å¾…è™•ç†

### â¬œ 5.3 E2E æ¸¬è©¦
- **ç‹€æ…‹**: ğŸ”² å¾…è™•ç†

---

## Phase 6: ğŸ’ é«”é©—æ‰“ç£¨ (P3) â€” éƒ¨åˆ†å®Œæˆ

### â¬œ 6.1 Tailwind è¨­å®šè£œå¼·
- **ç‹€æ…‹**: ğŸ”² å¾…è™•ç†

### âœ… 6.2 Availability API æ•ˆèƒ½å¾®å„ªåŒ–
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- ç§»é™¤ä¸å¿…è¦çš„ `async`/`Promise.all`

### â¬œ 6.3 SEO èˆ‡ Accessibility
- **ç‹€æ…‹**: ğŸ”² å¾…è™•ç†

---

## é–‹ç™¼æµç¨‹

```
master (ç·šä¸Šç‰ˆæœ¬ï¼Œä¸å‹•)
  â””â”€â”€ dev (é–‹ç™¼åˆ†æ”¯) â† ç›®å‰åœ¨é€™è£¡
       â”œâ”€â”€ Phase 1-4 å·²å®Œæˆ âœ…
       â”œâ”€â”€ Phase 3.1 (booking æ‹†åˆ†) å¾…è™•ç†
       â”œâ”€â”€ Phase 5 (æ¸¬è©¦) å¾…è™•ç†
       â””â”€â”€ ç¢ºèªç„¡èª¤å¾Œ â†’ PR â†’ merge to master â†’ éƒ¨ç½²åˆ° VPS
```

## å®Œæˆæ¨™æº–

- [x] æ‰€æœ‰ P0 (å®‰å…¨) é …ç›®å·²å®Œæˆ
- [x] æ‰€æœ‰ P1 (æ¸…ç†) é …ç›®å·²å®Œæˆ
- [ ] Build (`npm run build`) ç„¡éŒ¯èª¤
- [ ] åŸºæœ¬åŠŸèƒ½æ­£å¸¸ (é ç´„æµç¨‹ã€Admin ç™»å…¥ã€API)
- [ ] ç¶“ä½¿ç”¨è€…ç¢ºèªå¾Œ merge & deploy
